<ui:FluentWindow
    x:Class="ICOforge.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:ICOforge"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:viewModels="clr-namespace:ICOforge"
    Title="ICOforge"
    Width="750"
    Height="800"
    MinWidth="700"
    MinHeight="800"
    d:DataContext="{d:DesignInstance Type=viewModels:MainWindowViewModel,
                                     IsDesignTimeCreatable=False}"
    Icon="assets/icons/icoforge.ico"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">
    <Window.Resources>
        <local:HexToBrushConverter x:Key="HexToBrushConverter" />
        <local:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <Style x:Key="HelpTextStyle" TargetType="TextBlock">
            <Setter Property="Text" Value="(?)" />
            <Setter Property="Foreground" Value="{DynamicResource TextFillColorSecondaryBrush}" />
            <Setter Property="FontSize" Value="15" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="Margin" Value="5,0,0,0" />
        </Style>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <ui:TitleBar
            x:Name="TitleBar"
            Title="ICOforge"
            Grid.Row="0" />

        <Grid Grid.Row="1" Margin="20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="340" />
            </Grid.ColumnDefinitions>

            <Border
                Grid.Column="0"
                AllowDrop="True"
                Background="{DynamicResource ControlFillColorSecondaryBrush}"
                BorderBrush="Gray"
                BorderThickness="2"
                CornerRadius="5"
                DragEnter="DropZone_DragEnter"
                Drop="DropZone_Drop"
                MouseDown="DropZone_MouseDown">
                <Border.ContextMenu>
                    <ContextMenu>
                        <MenuItem Command="{Binding AddFilesCommand}" Header="Add Files..." />
                        <MenuItem Command="{Binding AddFolderCommand}" Header="Add Folder..." />
                    </ContextMenu>
                </Border.ContextMenu>
                <TextBlock
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    IsHitTestVisible="False"
                    TextAlignment="Center"
                    Visibility="{Binding IsDropZoneVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                    Drag and drop image files here<LineBreak />
                    or click to select</TextBlock>
            </Border>

            <ListView
                x:Name="FileListView"
                Grid.Column="0"
                Margin="5"
                AllowDrop="True"
                Background="Transparent"
                BorderThickness="0"
                DragEnter="DropZone_DragEnter"
                Drop="DropZone_Drop"
                IsHitTestVisible="{Binding IsFileListViewHitTestVisible}"
                ItemsSource="{Binding FileList}"
                KeyDown="FileListView_KeyDown"
                SelectionChanged="FileListView_SelectionChanged"
                SelectionMode="Extended">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Foreground="{DynamicResource TextFillColorPrimaryBrush}" Text="{Binding}" />
                    </DataTemplate>
                </ListView.ItemTemplate>
                <ListView.ContextMenu>
                    <ContextMenu>
                        <MenuItem Command="{Binding AddFilesCommand}" Header="Add Files..." />
                        <MenuItem Command="{Binding AddFolderCommand}" Header="Add Folder..." />
                        <Separator />
                        <MenuItem Command="{Binding AnalyzeIcoCommand}" Header="Analyze Selected ICO" />
                        <Separator />
                        <MenuItem Command="{Binding DeleteSelectedFilesCommand}" Header="Delete Selected" />
                        <MenuItem Command="{Binding ClearListCommand}" Header="Clear List" />
                    </ContextMenu>
                </ListView.ContextMenu>
            </ListView>

            <Grid Grid.Column="1" Margin="20,0,0,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" VerticalAlignment="Top">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock
                            FontSize="17"
                            FontWeight="Bold"
                            Text="Output Profile..." />
                        <TextBlock Style="{StaticResource HelpTextStyle}">
                            <TextBlock.ToolTip>
                                <ToolTip>Select a profile to determine the output type and included icon sizes.</ToolTip>
                            </TextBlock.ToolTip>
                        </TextBlock>
                    </StackPanel>
                    <ComboBox
                        Margin="10,5,0,0"
                        DisplayMemberPath="Name"
                        ItemsSource="{Binding Options.Profiles}"
                        SelectedItem="{Binding Options.SelectedProfile}">
                        <ComboBox.ItemContainerStyle>
                            <Style TargetType="ComboBoxItem">
                                <Setter Property="ToolTip" Value="{Binding ToolTip}" />
                            </Style>
                        </ComboBox.ItemContainerStyle>
                    </ComboBox>

                    <StackPanel Margin="0,20,0,0" Orientation="Horizontal">
                        <TextBlock
                            FontSize="17"
                            FontWeight="Bold"
                            Text="ICO Sizes..." />
                        <TextBlock Style="{StaticResource HelpTextStyle}">
                            <TextBlock.ToolTip>
                                <ToolTip>Select which sizes to embed in the final .ico file. Available when 'Custom' or 'Favicon Pack' profile is selected.</ToolTip>
                            </TextBlock.ToolTip>
                        </TextBlock>
                    </StackPanel>

                    <ItemsControl
                        Margin="10,10,0,0"
                        IsEnabled="{Binding Options.IsIcoSizesEnabled}"
                        ItemsSource="{Binding Options.IcoSizes}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <UniformGrid Columns="3" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <CheckBox
                                    Margin="0,0,0,5"
                                    Content="{Binding Label}"
                                    IsChecked="{Binding IsSelected}" />
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <StackPanel Margin="0,20,0,0" Orientation="Horizontal">
                        <TextBlock
                            FontSize="17"
                            FontWeight="Bold"
                            Text="SVG Color..." />
                        <TextBlock Style="{StaticResource HelpTextStyle}">
                            <TextBlock.ToolTip>
                                <ToolTip>Apply a color overlay to SVG files. This is best suited for single-color SVGs as it will convert the image to grayscale before applying the tint. Click the color swatch for a picker.</ToolTip>
                            </TextBlock.ToolTip>
                        </TextBlock>
                    </StackPanel>

                    <StackPanel Margin="10,5,0,0" Orientation="Horizontal">
                        <CheckBox
                            Margin="0,0,5,0"
                            VerticalAlignment="Center"
                            IsChecked="{Binding Options.EnableSvgColorization}" />
                        <StackPanel IsEnabled="{Binding Options.EnableSvgColorization}" Orientation="Horizontal">
                            <ui:TextBox
                                x:Name="SvgColorTextBox"
                                Width="120"
                                Text="{Binding Options.SvgColor, UpdateSourceTrigger=PropertyChanged}" />
                            <Grid
                                Width="{Binding ActualHeight, ElementName=SvgColorTextBox}"
                                Height="{Binding ActualHeight, ElementName=SvgColorTextBox}"
                                Margin="10,0,0,0"
                                Cursor="Hand">
                                <Grid.InputBindings>
                                    <MouseBinding Command="{Binding OpenColorPickerCommand}" MouseAction="LeftClick" />
                                </Grid.InputBindings>
                                <Rectangle
                                    Fill="{Binding Path=Text, ElementName=SvgColorTextBox, Converter={StaticResource HexToBrushConverter}, FallbackValue=Gray}"
                                    RadiusX="4"
                                    RadiusY="4"
                                    Stroke="Gray"
                                    StrokeThickness="1" />
                                <Image
                                    Margin="2"
                                    Opacity="0.33"
                                    Source="pack://application:,,,/assets/icons/paint-bucket.png" />
                            </Grid>
                        </StackPanel>
                    </StackPanel>

                    <StackPanel Margin="0,20,0,0" Orientation="Horizontal">
                        <TextBlock
                            FontSize="17"
                            FontWeight="Bold"
                            Text="Compression..." />
                        <TextBlock Style="{StaticResource HelpTextStyle}">
                            <TextBlock.ToolTip>
                                <ToolTip>Apply lossy compression and adjust color depth as required.</ToolTip>
                            </TextBlock.ToolTip>
                        </TextBlock>
                    </StackPanel>

                    <StackPanel
                        Margin="10,5,0,0"
                        VerticalAlignment="Center"
                        Orientation="Horizontal">
                        <CheckBox
                            x:Name="LossyCompressionCheckBox"
                            VerticalAlignment="Center"
                            Content="Lossy compression @"
                            IsChecked="{Binding Options.UseLossyCompression}" />
                        <ComboBox
                            Margin="5,0,5,0"
                            VerticalAlignment="Center"
                            IsEnabled="{Binding IsChecked, ElementName=LossyCompressionCheckBox}"
                            ItemsSource="{Binding Options.ColorOptions}"
                            SelectedItem="{Binding Options.SelectedColorCount}" />
                        <TextBlock
                            Margin="5,0,5,0"
                            VerticalAlignment="Center"
                            IsEnabled="{Binding IsChecked, ElementName=LossyCompressionCheckBox}"
                            Text="colors" />
                    </StackPanel>

                    <TextBlock
                        Margin="0,20,0,0"
                        FontSize="17"
                        FontWeight="Bold"
                        Text="Output to..." />
                    <RadioButton
                        Margin="20,5,0,0"
                        Content="Same as source"
                        GroupName="OutputLocation"
                        IsChecked="{Binding Options.IsOutputToSource}" />
                    <RadioButton Margin="20,5,0,0" GroupName="OutputLocation">
                        <TextBlock TextWrapping="Wrap">
                            <Run Text="Custom:" />
                            <Hyperlink
                                Command="{Binding BrowseOutputCommand}"
                                Foreground="#6bc2f5"
                                TextDecorations="Underline">
                                <Run Text="{Binding Options.CustomLocationText}" />
                            </Hyperlink>
                        </TextBlock>
                    </RadioButton>
                </StackPanel>
            </Grid>
        </Grid>

        <Grid Grid.Row="2" Margin="20,10,20,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="340" />
            </Grid.ColumnDefinitions>

            <StackPanel
                Grid.Column="0"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Cursor="Hand"
                Orientation="Horizontal"
                PreviewMouseDown="AboutPanel_PreviewMouseDown">
                <Image
                    x:Name="LogoImage"
                    Width="64"
                    Height="64" />
                <TextBlock
                    Margin="10,0,0,0"
                    VerticalAlignment="Center"
                    FontFamily="pack://application:,,,/assets/fonts/#Source Code Pro"
                    FontSize="32"
                    Foreground="#1097e5"
                    Text="ICOforge" />
            </StackPanel>

            <ui:Button
                Grid.Column="1"
                Height="40"
                Padding="20,0"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Appearance="Primary"
                Command="{Binding CreateFilesCommand}">
                <TextBlock FontSize="18" Text="Create Files" />
            </ui:Button>
        </Grid>

        <Grid
            Grid.Row="0"
            Grid.RowSpan="3"
            Background="#AA000000"
            Visibility="{Binding IsProcessing, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <TextBlock
                    Margin="0,0,0,20"
                    HorizontalAlignment="Center"
                    FontSize="24"
                    Text="Processing..." />
                <ProgressBar
                    Width="300"
                    Height="20"
                    Value="{Binding ConversionProgress}" />
                <TextBlock
                    Margin="0,10,0,0"
                    HorizontalAlignment="Center"
                    FontSize="16"
                    Text="{Binding ProgressFileText}" />
            </StackPanel>
        </Grid>
    </Grid>
</ui:FluentWindow>
